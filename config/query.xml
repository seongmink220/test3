<?xml version="1.0"?>
<dbquery>
 <process>
 <!-- 
	 WITH PROCNAME AS (
	SELECT 'NEWONLINE01' AS SERVER FROM DUAL    
	UNION ALL SELECT 'NEWONLINE02' AS SERVER FROM DUAL
	UNION ALL SELECT 'NEWONLINE03' AS SERVER FROM DUAL
	UNION ALL SELECT 'NEWONLINE04' AS SERVER FROM DUAL
	UNION ALL 
	SELECT 'V_TERMSVR1' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR2' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR3' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR4' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR5' AS SERVER FROM DUAL    
	UNION ALL SELECT 'V_TERMSVR6' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR7' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR8' AS SERVER FROM DUAL
	UNION ALL SELECT 'V_TERMSVR9' AS SERVER FROM DUAL   
	) 
	SELECT A.SERVER FROM PROCNAME A,
	(
	select SUBSTR(MERCHANTPROCNAME,0,10) AS SERVER,COUNT(*) from VANON.TBLTLF20210216 WHERE 
	UNIQUENO BETWEEN '210216'||'010000'||'000000' AND '210216'||'015959'||'999999' 
	AND 
	INS_DT BETWEEN TO_DATE('20210216'||'010000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210216'||'015959','YYYY-MM-DD HH24:MI:SS')
	AND MERCHANTPROCNAME LIKE 'V_TERMSVR%'
	GROUP BY SUBSTR(MERCHANTPROCNAME,0,10)
	UNION ALL
	select MERCHANTPROCNAME AS SERVER,COUNT(*) from VANON.TBLTLF20200216 WHERE 
	UNIQUENO BETWEEN '210216'||'010000'||'000000' AND '210216'||'015959'||'999999'  
	AND 
	INS_DT BETWEEN TO_DATE('20210216'||'010000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210216'||'015959','YYYY-MM-DD HH24:MI:SS')
	AND MERCHANTPROCNAME LIKE 'NEWONLINE%'
	GROUP BY MERCHANTPROCNAME
	) B WHERE A.SERVER = B.SERVER(+) AND B.SERVER IS NULL
 -->
   WITH PROCNAME AS (
	--SELECT 'NEWONLINE01' AS SERVER FROM DUAL    
	--UNION ALL SELECT 'NEWONLINE02' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE03' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE04' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE05' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE06' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE07' AS SERVER FROM DUAL    
	--UNION ALL SELECT 'NEWONLINE08' AS SERVER FROM DUAL
	--UNION ALL SELECT 'NEWONLINE09' AS SERVER FROM DUAL
	--UNION ALL 
	--SELECT 'V_TERMSVR1' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR2' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR3' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR4' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR5' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR6' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR7' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR8' AS SERVER FROM DUAL
	--UNION ALL SELECT 'V_TERMSVR9' AS SERVER FROM DUAL
        SELECT 'NEWONLINE01' AS SERVER FROM DUAL
        UNION ALL SELECT 'NEWONLINE02' AS SERVER FROM DUAL
        UNION ALL SELECT 'NEWONLINE03' AS SERVER FROM DUAL
        UNION ALL SELECT 'NEWONLINE04' AS SERVER FROM DUAL
        UNION ALL SELECT 'NEWONLINE05' AS SERVER FROM DUAL
        --UNION ALL SELECT 'NEWONLINE06' AS SERVER FROM DUAL
        --UNION ALL SELECT 'NEWONLINE07' AS SERVER FROM DUAL
        --UNION ALL SELECT 'NEWONLINE08' AS SERVER FROM DUAL
        --UNION ALL SELECT 'NEWONLINE09' AS SERVER FROM DUAL       
	) 
	SELECT A.SERVER FROM PROCNAME A,
	(
	SELECT SUBSTR(MERCHANTPROCNAME,0,10) AS SERVER,COUNT(*) FROM VANON.TBLTLF[DATE] WHERE 
	UNIQUENO BETWEEN ? AND ? 
	AND 
	INS_DT BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')
	AND MERCHANTPROCNAME LIKE 'V_TERMSVR%'
	GROUP BY SUBSTR(MERCHANTPROCNAME,0,10)
	UNION ALL
	SELECT MERCHANTPROCNAME AS SERVER,COUNT(*) FROM VANON.TBLTLF[DATE] WHERE 
	UNIQUENO BETWEEN ? AND ?  
	AND 
	INS_DT BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')
	AND MERCHANTPROCNAME LIKE 'NEWONLINE%'
	GROUP BY MERCHANTPROCNAME
	) B WHERE A.SERVER = B.SERVER(+) AND B.SERVER IS NULL
 </process>
 <mang>
  <!--
  SELECT COUNT(*) FROM VANON.TBLTLF%s WHERE UNIQUENO BETWEEN '{}'||'{}0000'||'000000' AND '{}'||'{}5959'||'999999' AND MSGTYPE='08' AND REPLYCODE='8412' 
         AND TRANTIME BETWEEN '{}0000' AND '{}5959'  AND OLDAUTHNO IS NULL 
		 AND INS_DT BETWEEN TO_DATE('{}0000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('{}5959','YYYY-MM-DD HH24:MI:SS') 
		 ORDER BY UNIQUENO ASC
		 
		 '2000000574','2000011357' 리얼테스트 가맹점 제외
		 
  select COUNT(*) from TBLTLF20230515 WHERE UNIQUENO BETWEEN '230515120000000000' AND '230515125959999999' AND (TERMINALID,CARDNO,TRANSEQNO) NOT IN (
    select /*+RULE */ TERMINALID,CARDNO,TRANSEQNO from TBLTLF20230515 WHERE UNIQUENO BETWEEN '230515120000000000' AND '230515125959999999' AND (TERMINALID,CARDNO,TRANSEQNO) IN (
     SELECT /*+RULE */  TERMINALID,CARDNO,TRANSEQNO FROM VANON.TBLTLF20230515 WHERE  UNIQUENO BETWEEN '230515120000000000' AND '230515125959999999'  AND TRANTIME BETWEEN '120000' and '125959' AND MSGTYPE='08' AND REPLYCODE='8412' AND REPLYMSG='거래내역 없음'
              AND OLDAUTHNO IS NULL AND TERMINALID NOT IN ('2000000574','2000011357')
    ) AND MSGTYPE IN ('01','06') AND TRANTIME BETWEEN '120000' and '125959'        
  ) AND  MSGTYPE ='08' AND TRANTIME BETWEEN '120000' and '125959' AND REPLYCODE='8412' AND REPLYMSG='거래내역 없음' AND TERMINALID NOT IN ('2000000574','2000011357')
  
   SELECT COUNT(*) FROM VANON.TBLTLF%s WHERE UNIQUENO BETWEEN ? AND ? AND MSGTYPE='08' AND REPLYCODE='8412' AND REPLYMSG='거래내역 없음'
         AND TRANTIME BETWEEN ? AND ?  AND OLDAUTHNO IS NULL AND TERMINALID NOT IN ('2000000574','2000011357')
		 AND INS_DT BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')		 
  -->
  
  select COUNT(*) from TBLTLF%s WHERE UNIQUENO BETWEEN ? AND ? AND (TERMINALID,CARDNO,TRANSEQNO) NOT IN (
    select /*+RULE */ TERMINALID,CARDNO,TRANSEQNO from TBLTLF%s WHERE UNIQUENO BETWEEN ? AND ? AND (TERMINALID,CARDNO,TRANSEQNO) IN (
     SELECT /*+RULE */  TERMINALID,CARDNO,TRANSEQNO FROM VANON.TBLTLF%s WHERE  UNIQUENO BETWEEN ? AND ?  AND TRANTIME BETWEEN ? and ? AND MSGTYPE='08' AND REPLYCODE='8412' AND REPLYMSG='거래내역 없음'
              AND OLDAUTHNO IS NULL AND TERMINALID NOT IN ('2000000574','2000011357')
    ) AND MSGTYPE IN ('01','06') AND TRANTIME BETWEEN ? and ?        
  ) AND  MSGTYPE ='08' AND TRANTIME BETWEEN ? and ? AND REPLYCODE='8412' AND REPLYMSG='거래내역 없음' AND TERMINALID NOT IN ('2000000574','2000011357')
		 
 </mang>
 
 <noregshop>
 <!--  
   SELECT MERCHANTNAME,COUNT(*) FROM VANON.TBLTLF20210121 WHERE 
	UNIQUENO BETWEEN '210121'||'140000'||'000000' AND '210121'||'145959'||'999999'  
	AND 
	INS_DT BETWEEN TO_DATE('20210121'||'140000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210121'||'145959','YYYY-MM-DD HH24:MI:SS') 
	AND HOSTREPLYCODE='8331' 
	GROUP BY MERCHANTNAME HAVING COUNT(*) > 10
 -->
 SELECT MERCHANTNAME,COUNT(*) FROM VANON.TBLTLF%s WHERE 
	UNIQUENO BETWEEN ? AND ?  
	AND 
	INS_DT BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') 
	AND HOSTREPLYCODE='8331'  AND TERMINALID NOT IN ('2000040357')
	GROUP BY MERCHANTNAME HAVING COUNT(*) > ?
 </noregshop>
 
 <stateinfo>
 <!-- 
  SELECT A.TERMINAL_ID,A.PLACE,B.CNT FROM
	TB_VENDING_MACHINE A,
	(
	SELECT TERMINAL_ID,COUNT(*) AS CNT FROM TB_TXT_STATUS WHERE CREATE_DATE BETWEEN TO_DATE('20210304'||'110000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210304'||'115959','YYYY-MM-DD HH24:MI:SS') 
	GROUP BY TERMINAL_ID HAVING COUNT(*) >= 20
	) B WHERE A.TERMINAL_ID=B.TERMINAL_ID
 -->
  SELECT TERMINAL_ID,COUNT(*) AS CNT FROM TB_TXT_STATUS WHERE CREATE_DATE BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TERMINAL_ID NOT IN ('2000047163')
	GROUP BY TERMINAL_ID HAVING COUNT(*) >= ?	
 </stateinfo>
 <tlftb>
    <!-- 일일원장 테이블생성 확인 -->
 	SELECT COUNT(*) AS CNT FROM VANON.TBLTLF%s
 </tlftb>
 <ictlftb>
    <!-- 일일원장 테이블생성 확인 -->
 	SELECT COUNT(*) AS CNT FROM VANON.TBLICTLF%s
 </ictlftb>
<statinfo_term>
<!-- 
SELECT TERMINAL_ID,COUNT(*) AS CNT FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = '20000313213' AND  
 CREATE_DATE BETWEEN TO_DATE('20210504140000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210504145959','YYYY-MM-DD HH24:MI:SS') 
GROUP BY TERMINAL_ID
-->
SELECT TERMINAL_ID,COUNT(*) AS CNT FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = ? AND  
 CREATE_DATE BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') 
GROUP BY TERMINAL_ID
</statinfo_term> 

<statinfo_term_time>
<!--
SELECT CREATETIME FROM (
SELECT TO_CHAR(CREATE_DATE,'YYYYMMDDHH24MISS') AS CREATETIME 
FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = '2000040870' AND  
 CREATE_DATE BETWEEN TO_DATE('20210505130000','YYYY-MM-DD HH24:MI:SS') AND TO_DATE('20210505135959','YYYY-MM-DD HH24:MI:SS')
ORDER BY CREATE_DATE DESC ) A WHERE ROWNUM=1 
-->
SELECT CREATETIME FROM (
SELECT TO_CHAR(CREATE_DATE,'YYYYMMDDHH24MISS') AS CREATETIME 
FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = ? AND  
 CREATE_DATE BETWEEN TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')
ORDER BY CREATE_DATE DESC ) A WHERE ROWNUM=1 
</statinfo_term_time>

<statinfo_term_time_last>
<!--
SELECT CREATETIME FROM (
SELECT TO_CHAR(CREATE_DATE,'YYYYMMDDHH24MISS') AS CREATETIME 
FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = 2000044454 AND  
 CREATE_DATE >= TO_DATE('20210517000000','YYYY-MM-DD HH24:MI:SS')
ORDER BY CREATE_DATE DESC ) A WHERE ROWNUM=1 
-->
SELECT CREATETIME FROM (
SELECT TO_CHAR(CREATE_DATE,'YYYYMMDDHH24MISS') AS CREATETIME 
FROM TB_TXT_STATUS 
WHERE TERMINAL_ID = ? AND  
 CREATE_DATE >= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')
ORDER BY CREATE_DATE DESC ) A WHERE ROWNUM=1
</statinfo_term_time_last>

</dbquery>
